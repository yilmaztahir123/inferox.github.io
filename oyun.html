<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Jet SavaÅŸÄ±</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #000;
            overflow: hidden;
            font-family: 'Arial', sans-serif;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }
        #gameCanvas {
            display: block;
            margin: 0 auto;
            background: #000;
            border: 2px solid #444;
        }
        #gameUI {
            color: white;
            text-align: center;
            padding: 10px;
            text-shadow: 2px 2px 4px #000;
            position: absolute;
            top: 0;
            width: 100%;
            box-sizing: border-box;
            pointer-events: none;
            z-index: 2;
        }
        #startScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            z-index: 10;
        }
        #startButton {
            padding: 15px 30px;
            font-size: 24px;
            background: linear-gradient(to bottom, #f46b45, #eea849);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 20px;
            font-weight: bold;
            text-shadow: 1px 1px 2px #000;
            box-shadow: 0 0 15px rgba(238, 168, 73, 0.7);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        #startButton:active {
            transform: scale(0.95);
            box-shadow: 0 0 10px rgba(238, 168, 73, 0.5);
        }
        #controls {
            margin-top: 20px;
            color: #ddd;
            background-color: rgba(0, 0, 0, 0.5);
            padding: 15px;
            border-radius: 10px;
            max-width: 90%;
            text-align: center;
        }
        .title {
            font-size: 36px;
            margin-bottom: 15px;
            color: #f46b45;
            text-shadow: 3px 3px 6px #000;
            font-family: 'Impact', sans-serif;
        }
        .game-over {
            color: #ff5555;
            font-size: 30px;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px #000;
        }
        .health-bar {
            width: 100px;
            height: 15px;
            background-color: #333;
            border-radius: 7px;
            margin: 5px auto;
            overflow: hidden;
            display: inline-block;
            vertical-align: middle;
        }
        .health-fill {
            height: 100%;
            background: linear-gradient(to right, #ff0000, #ff5e00);
            width: 100%;
            transition: width 0.3s;
        }
        #mobileControls {
            position: absolute;
            bottom: 20px;
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 20px;
            box-sizing: border-box;
            z-index: 5;
            touch-action: manipulation;
        }
        .mobile-btn {
            width: 60px;
            height: 60px;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 24px;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }
        .mobile-btn:active {
            background-color: rgba(255, 255, 255, 0.4);
        }
        #fireBtn {
            position: absolute;
            right: 20px;
            bottom: 100px;
            background-color: rgba(255, 0, 0, 0.3);
            width: 80px;
            height: 80px;
        }
        #fireBtn:active {
            background-color: rgba(255, 0, 0, 0.5);
        }
        .powerup-tag {
            display: inline-block;
            padding: 2px 8px;
            background-color: rgba(52, 152, 219, 0.5);
            border-radius: 10px;
            margin-left: 5px;
            font-size: 12px;
        }
        #joystick {
            position: absolute;
            left: 30px;
            bottom: 30px;
            width: 100px;
            height: 100px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            display: none;
            z-index: 6;
        }
        #joystickKnob {
            position: absolute;
            width: 40px;
            height: 40px;
            background-color: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            top: 30px;
            left: 30px;
            transition: transform 0.1s;
        }
    </style>
</head>
<body>
    <div id="gameUI">
        <div>Skor: <span id="score">0</span> | Can: <span id="lives">3</span> <div class="health-bar"><div id="healthFill" class="health-fill"></div></div></div>
        <div>GÃ¼Ã§: <span id="powerup">Yok</span></div>
    </div>
    
    <canvas id="gameCanvas"></canvas>
    
    <div id="mobileControls">
        <div id="joystick">
            <div id="joystickKnob"></div>
        </div>
        <div id="fireBtn" class="mobile-btn">ðŸ”«</div>
    </div>
    
    <div id="startScreen">
        <div class="title">JET SAVAÅžI</div>
        <p>DÃ¼ÅŸman ateÅŸ toplarÄ±nÄ± yok et ve galaksimizi koru!</p>
        <div id="controls">
            <strong>Ã–ZEL Ä°KSÄ°RLER:</strong><br>
            <span style="color:#2ecc71">YeÅŸil Ä°ksir</span> - +1 Can<br>
            <span style="color:#3498db">Mavi Ä°ksir</span> - Klonlanma (10s)<br>
            <span style="color:#e74c3c">KÄ±rmÄ±zÄ± Ä°ksir</span> - HÄ±z ArtÄ±ÅŸÄ± (8s)<br>
            <span style="color:#9b59b6">Mor Ä°ksir</span> - ÃœÃ§lÃ¼ AteÅŸ (12s)
        </div>
        <button id="startButton">OYUNA BAÅžLA</button>
    </div>

    <script>
        // Oyun boyutlarÄ±nÄ± ayarla (mobil uyumlu)
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        resizeCanvas();
        
        function resizeCanvas() {
            const size = Math.min(window.innerWidth, window.innerHeight * 1.5);
            canvas.width = size;
            canvas.height = Math.min(window.innerHeight, window.innerWidth * 1.5);
        }
        
        window.addEventListener('resize', resizeCanvas);
        
        // Resimler - Optimize edilmiÅŸ SVG tabanlÄ± gÃ¶rseller
        const jetImg = new Image();
        jetImg.src = 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cGF0aCBkPSJNNTAgMTBDNzAgMTUgODAgMzAgNzAgNTBMOTAgNTBMNTAgOTBMMTAgNTBMMzAgNTBDMjAgMzAgMzAgMTUgNTAgMTBaIiBmaWxsPSIjMDA3N0ZGIiBzdHJva2U9IiMwMDU1QkIiIHN0cm9rZS13aWR0aD0iMiIvPjxwYXRoIGQ9Ik0zMCA1MEg3MCIgc3Ryb2tlPSIjMDA1NUJCIiBzdHJva2Utd2lkdGg9IjQiLz48cGF0aCBkPSJNNDAgNTBMNTAgNzBNNjAgNTBMNTAgNzAiIHN0cm9rZT0iIzAwOTlGRiIgc3Ryb2tlLXdpZHRoPSIyIi8+PHBhdGggZD0iTTQ1IDQ1TDUwIDUwTDU1IDQ1IiBzdHJva2U9IiNGRkYiIHN0cm9rZS13aWR0aD0iMiIvPjwvc3ZnPg==';
        
        const enemyFireImgs = [
            'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48Y2lyY2xlIGN4PSI1MCIgY3k9IjUwIiByPSI0MCIgZmlsbD0idXJsKCNmaXJlR3JhZGllbnQpIi8+PGRlZnM+PHJhZGlhbEdyYWRpZW50IGlkPSJmaXJlR3JhZGllbnQiIGN4PSI1MCIgY3k9IjUwIiByPSI1MCIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiPjxzdG9wIG9mZnNldD0iMCUiIHN0b3AtY29sb3I9IiNGRjkwMDAiLz48c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiNGRjAwMDAiLz48L3JhZGlhbEdyYWRpZW50PjwvZGVmcz48L3N2Zz4=',
            'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48ZWxsaXBzZSBjeD0iNTAiIGN5PSI1MCIgcng9IjQwIiByeT0iMzAiIGZpbGw9InVybCgjZmlyZUdyYWRpZW50KSIgdHJhbnNmb3JtPSJyb3RhdGUoLTMwIDUwIDUwKSIvPjxkZWZzPjxyYWRpYWxHcmFkaWVudCBpZD0iZmlyZUdyYWRpZW50IiBjeD0iNTAiIGN5PSI1MCIgcj0iNTAiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIj48c3RvcCBvZmZzZXQ9IjAlIiBzdG9wLWNvbG9yPSIjRkY5MDAwIi8+PHN0b3Agb2Zmc2V0PSIxMDAlIiBzdG9wLWNvbG9yPSIjRkYwMDAwIi8+PC9yYWRpYWxHcmFkaWVudD48L2RlZnM+PC9zdmc+',
            'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cGF0aCBkPSJNNTAgMTBDNzAgMTUgODAgMzAgNzAgNTBMOTAgNTBMNTAgOTBMMTAgNTBMMzAgNTBDMjAgMzAgMzAgMTUgNTAgMTBaIiBmaWxsPSJ1cmwoI2ZpcmVHcmFkaWVudCkiIHRyYW5zZm9ybT0icm90YXRlKDMwIDUwIDUwKSIvPjxkZWZzPjxyYWRpYWxHcmFkaWVudCBpZD0iZmlyZUdyYWRpZW50IiBjeD0iNTAiIGN5PSI1MCIgcj0iNTAiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIj48c3RvcCBvZmZzZXQ9IjAlIiBzdG9wLWNvbG9yPSIjRkY5MDAwIi8+PHN0b3Agb2Zmc2V0PSIxMDAlIiBzdG9wLWNvbG9yPSIjRkYwMDAwIi8+PC9yYWRpYWxHcmFkaWVudD48L2RlZnM+PC9zdmc+'
        ].map(src => {
            const img = new Image();
            img.src = src;
            return img;
        });
        
        // GÃ¼Ã§ kutusu gÃ¶rselleri (iksir ÅŸiÅŸeleri)
        const powerupImgs = {
            health: createPotionImage('#2ecc71'),
            clone: createPotionImage('#3498db'),
            speed: createPotionImage('#e74c3c'),
            double: createPotionImage('#9b59b6')
        };
        
        function createPotionImage(color) {
            const img = new Image();
            img.src = `data:image/svg+xml;base64,${btoa(`
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 100">
                    <path d="M15 10H35V40C35 55 25 65 25 80C25 95 35 85 35 70V90H15V70C15 85 5 95 5 80C5 65 15 55 15 40V10Z" fill="${color}"/>
                    <path d="M15 10H35V15H15V10Z" fill="#fff" opacity="0.5"/>
                    <path d="M10 40C10 55 20 65 20 80C20 95 10 85 10 70V40Z" fill="#fff" opacity="0.2"/>
                </svg>
            `)}`;
            return img;
        }
        
        // Oyun durumu
        let score = 0;
        let lives = 3;
        let health = 100;
        let gameRunning = false;
        let animationFrameId;
        let gameOverEffect = false;
        let gameOverTimer = 0;
        let lastEnemyFireSpawn = 0;
        let enemyFireSpeed = 2;
        let maxEnemyFireSpeed = 8;
        let enemyFireSpawnRate = 1500;
        let difficultyIncreaseInterval = 5000;
        let lastDifficultyIncrease = 0;
        let powerupActive = null;
        let powerupEndTime = 0;
        let cloneJet = null;
        let joystickActive = false;
        let joystickAngle = 0;
        let joystickForce = 0;
        let lastPowerupSpawn = 0;
        let powerupSpawnInterval = 20000; // 20 saniyede bir gÃ¼Ã§ kutusu
        
        // Jet Ã¶zellikleri
        const jet = {
            x: canvas.width / 2,
            y: canvas.height - 100,
            width: 60,
            height: 50,
            speed: 6,
            baseSpeed: 6,
            img: jetImg,
            bullets: [],
            lastShot: 0,
            shootDelay: 200, // Daha hÄ±zlÄ± ateÅŸ
            engineParticles: [],
            shootAnimation: 0
        };
        
        // DÃ¼ÅŸman ateÅŸ toplarÄ±
        const enemyFires = [];
        const powerups = [];
        const explosions = [];
        const bullets = [];
        
        // YÄ±ldÄ±zlar arka plan iÃ§in
        const stars = [];
        for (let i = 0; i < 150; i++) {
            stars.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                size: Math.random() * 3 + 1,
                speed: Math.random() * 0.8 + 0.2,
                alpha: Math.random() * 0.7 + 0.3,
                twinkle: Math.random() > 0.7
            });
        }
        
        // TuÅŸ kontrolleri
        const keys = {
            ArrowUp: false,
            ArrowDown: false,
            ArrowLeft: false,
            ArrowRight: false,
            w: false,
            a: false,
            s: false,
            d: false,
            ' ': false
        };
        
        // Mobil kontroller
        let touchStartX = 0;
        let touchStartY = 0;
        let isFiring = false;
        
        // Joystick iÃ§in
        const joystick = {
            baseX: 0,
            baseY: 0,
            knobX: 0,
            knobY: 0,
            active: false
        };
        
        // Olay dinleyicileri
        window.addEventListener('keydown', (e) => {
            if (keys.hasOwnProperty(e.key)) {
                keys[e.key] = true;
                
                if (e.key === ' ' && gameRunning) {
                    shootBullet();
                }
            }
        });
        
        window.addEventListener('keyup', (e) => {
            if (keys.hasOwnProperty(e.key)) {
                keys[e.key] = false;
            }
        });
        
        // Mobil kontroller
        function setupMobileControls() {
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            const fireBtn = document.getElementById('fireBtn');
            
            if (isMobile) {
                // Joystick iÃ§in dokunma olaylarÄ±
                document.addEventListener('touchstart', handleTouchStart, { passive: false });
                document.addEventListener('touchmove', handleTouchMove, { passive: false });
                document.addEventListener('touchend', handleTouchEnd, { passive: false });
                
                // AteÅŸ butonu
                fireBtn.style.display = 'flex';
                fireBtn.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    isFiring = true;
                    if (gameRunning) shootBullet();
                });
                fireBtn.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    isFiring = false;
                });
            } else {
                fireBtn.style.display = 'none';
            }
        }
        
        function handleTouchStart(e) {
            if (!gameRunning) return;
            
            const touch = e.touches[0];
            touchStartX = touch.clientX;
            touchStartY = touch.clientY;
            
            // Joystick alanÄ± (sol alt kÃ¶ÅŸe)
            const joystickArea = {
                left: 0,
                top: canvas.height - 150,
                right: 150,
                bottom: canvas.height
            };
            
            if (touch.clientX < joystickArea.right && touch.clientY > joystickArea.top) {
                joystick.active = true;
                joystick.baseX = touch.clientX;
                joystick.baseY = touch.clientY;
                joystick.knobX = touch.clientX;
                joystick.knobY = touch.clientY;
                
                // Joystick gÃ¶rÃ¼nÃ¼r yap
                const joystickElement = document.getElementById('joystick');
                joystickElement.style.display = 'block';
                joystickElement.style.left = (joystick.baseX - 50) + 'px';
                joystickElement.style.bottom = (canvas.height - joystick.baseY + 50) + 'px';
            }
        }
        
        function handleTouchMove(e) {
            if (!gameRunning || !joystick.active) return;
            
            e.preventDefault();
            const touch = e.touches[0];
            
            // Joystick hareketi
            const dx = touch.clientX - joystick.baseX;
            const dy = touch.clientY - joystick.baseY;
            const distance = Math.sqrt(dx * dx + dy * dy);
            const maxDistance = 50;
            
            if (distance < maxDistance) {
                joystick.knobX = touch.clientX;
                joystick.knobY = touch.clientY;
            } else {
                const angle = Math.atan2(dy, dx);
                joystick.knobX = joystick.baseX + Math.cos(angle) * maxDistance;
                joystick.knobY = joystick.baseY + Math.sin(angle) * maxDistance;
            }
            
            // Joystick knob pozisyonunu gÃ¼ncelle
            const knobElement = document.getElementById('joystickKnob');
            knobElement.style.transform = `translate(${joystick.knobX - joystick.baseX}px, ${joystick.knobY - joystick.baseY}px)`;
            
            // AÃ§Ä± ve kuvvet hesapla
            joystickAngle = Math.atan2(joystick.knobY - joystick.baseY, joystick.knobX - joystick.baseX);
            joystickForce = Math.min(1, distance / maxDistance);
        }
        
        function handleTouchEnd(e) {
            if (!gameRunning) return;
            
            // Joystick'i sÄ±fÄ±rla
            joystick.active = false;
            joystickForce = 0;
            document.getElementById('joystick').style.display = 'none';
            document.getElementById('joystickKnob').style.transform = 'translate(0, 0)';
        }
        
        document.getElementById('startButton').addEventListener('click', startGame);
        
        // Oyun fonksiyonlarÄ±
        function startGame() {
            startScreen.style.display = 'none';
            score = 0;
            lives = 3;
            health = 100;
            updateUI();
            gameRunning = true;
            gameOverEffect = false;
            enemyFires.length = 0;
            powerups.length = 0;
            explosions.length = 0;
            bullets.length = 0;
            jet.bullets.length = 0;
            jet.engineParticles.length = 0;
            powerupActive = null;
            cloneJet = null;
            enemyFireSpeed = 2;
            maxEnemyFireSpeed = 8;
            enemyFireSpawnRate = 1500;
            lastDifficultyIncrease = Date.now();
            lastPowerupSpawn = Date.now();
            
            // Jet baÅŸlangÄ±Ã§ pozisyonu
            jet.x = canvas.width / 2;
            jet.y = canvas.height - 100;
            jet.speed = jet.baseSpeed;
            jet.shootAnimation = 0;
            
            // Mobil kontrolleri ayarla
            setupMobileControls();
            
            // Oyun dÃ¶ngÃ¼sÃ¼nÃ¼ baÅŸlat
            gameLoop();
        }
        
        function gameLoop(timestamp) {
            if (!gameRunning) return;
            
            // Temizle
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Arka plan
            drawBackground();
            
            // Zorluk artÄ±ÅŸÄ±
            if (timestamp - lastDifficultyIncrease > difficultyIncreaseInterval) {
                increaseDifficulty();
                lastDifficultyIncrease = timestamp;
            }
            
            // GÃ¼Ã§ kutusu spawn
            if (timestamp - lastPowerupSpawn > powerupSpawnInterval && powerups.length < 1) {
                spawnPowerup();
                lastPowerupSpawn = timestamp;
            }
            
            // Jet hareketi
            updateJet(timestamp);
            
            // Klon jet varsa gÃ¼ncelle
            if (cloneJet) {
                updateCloneJet(timestamp);
            }
            
            // DÃ¼ÅŸman ateÅŸ topu spawn
            if (timestamp - lastEnemyFireSpawn > enemyFireSpawnRate) {
                spawnEnemyFire();
                lastEnemyFireSpawn = timestamp;
            }
            
            // DÃ¼ÅŸman ateÅŸ toplarÄ±nÄ± gÃ¼ncelle
            updateEnemyFires();
            
            // GÃ¼Ã§ kutularÄ±nÄ± gÃ¼ncelle
            updatePowerups();
            
            // Mermileri gÃ¼ncelle
            updateBullets();
            
            // PatlamalarÄ± gÃ¼ncelle
            updateExplosions(timestamp);
            
            // GÃ¼Ã§ zamanlayÄ±cÄ±
            updatePowerTimer(timestamp);
            
            // Ã‡arpÄ±ÅŸma kontrolÃ¼
            checkCollisions();
            
            // Oyun dÃ¶ngÃ¼sÃ¼nÃ¼ devam ettir
            animationFrameId = requestAnimationFrame(gameLoop);
            
            // Game over efekti
            if (gameOverEffect) {
                gameOverTimer++;
                const alpha = Math.min(0.7, gameOverTimer / 100);
                ctx.fillStyle = `rgba(200, 50, 50, ${alpha})`;
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                if (gameOverTimer > 120) {
                    gameOver();
                }
            }
            
            // SÃ¼rekli ateÅŸ iÃ§in
            if (isFiring && timestamp - jet.lastShot > jet.shootDelay) {
                shootBullet();
                jet.lastShot = timestamp;
            }
            
            // AteÅŸ animasyonunu gÃ¼ncelle
            if (jet.shootAnimation > 0) {
                jet.shootAnimation -= 2;
            }
        }
        
        function drawBackground() {
            // Uzay arka planÄ±
            ctx.fillStyle = '#000033';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // YÄ±ldÄ±zlar
            for (const star of stars) {
                if (star.twinkle) {
                    star.alpha = 0.3 + Math.abs(Math.sin(Date.now() / 500 + star.x)) * 0.7;
                }
                
                ctx.fillStyle = `rgba(255, 255, 255, ${star.alpha})`;
                ctx.beginPath();
                ctx.arc(star.x, star.y, star.size / 2, 0, Math.PI * 2);
                ctx.fill();
                
                // Hareket efekti
                star.y += star.speed;
                if (star.y > canvas.height) {
                    star.y = 0;
                    star.x = Math.random() * canvas.width;
                }
            }
        }
        
        function increaseDifficulty() {
            if (enemyFireSpeed < maxEnemyFireSpeed) {
                enemyFireSpeed = Math.min(maxEnemyFireSpeed, enemyFireSpeed + 0.3);
            }
            
            if (enemyFireSpawnRate > 600) {
                enemyFireSpawnRate -= 100;
            }
        }
        
        function updateJet(timestamp) {
            // Hareket (klavye)
            if (keys.ArrowUp || keys.w) jet.y -= jet.speed;
            if (keys.ArrowDown || keys.s) jet.y += jet.speed;
            if (keys.ArrowLeft || keys.a) jet.x -= jet.speed;
            if (keys.ArrowRight || keys.d) jet.x += jet.speed;
            
            // Hareket (joystick)
            if (joystick.active && joystickForce > 0.1) {
                const speed = jet.speed * joystickForce;
                jet.x += Math.cos(joystickAngle) * speed;
                jet.y += Math.sin(joystickAngle) * speed;
            }
            
            // SÄ±nÄ±r kontrolÃ¼
            jet.x = Math.max(0, Math.min(canvas.width - jet.width, jet.x));
            jet.y = Math.max(0, Math.min(canvas.height - jet.height, jet.y));
            
            // Motor partikÃ¼lleri
            if (gameRunning && !gameOverEffect) {
                if (Math.random() < 0.7) {
                    jet.engineParticles.push({
                        x: jet.x + jet.width / 2 + (Math.random() - 0.5) * 10,
                        y: jet.y + jet.height,
                        size: Math.random() * 4 + 3,
                        speedY: Math.random() * 4 + 3,
                        color: `hsl(${Math.random() * 40 + 30}, 100%, 50%)`,
                        life: 30 + Math.random() * 20
                    });
                }
                
                // PartikÃ¼lleri gÃ¼ncelle
                for (let i = jet.engineParticles.length - 1; i >= 0; i--) {
                    const p = jet.engineParticles[i];
                    p.y += p.speedY;
                    p.life--;
                    
                    if (p.life <= 0) {
                        jet.engineParticles.splice(i, 1);
                    }
                }
            }
            
            // Jet Ã§iz
            ctx.save();
            ctx.translate(jet.x + jet.width / 2, jet.y + jet.height / 2);
            
            // Hareket yÃ¶nÃ¼ne gÃ¶re hafif dÃ¶ndÃ¼rme
            let angle = 0;
            if ((keys.ArrowLeft || keys.a || (joystick.active && joystickAngle < -Math.PI/4 && joystickAngle > -3*Math.PI/4)) && 
                !(keys.ArrowRight || keys.d || (joystick.active && joystickAngle > Math.PI/4 && joystickAngle < 3*Math.PI/4))) {
                angle = -0.2;
            }
            if ((keys.ArrowRight || keys.d || (joystick.active && joystickAngle > Math.PI/4 && joystickAngle < 3*Math.PI/4)) && 
                !(keys.ArrowLeft || keys.a || (joystick.active && joystickAngle < -Math.PI/4 && joystickAngle > -3*Math.PI/4))) {
                angle = 0.2;
            }
            ctx.rotate(angle);
            
            // AteÅŸ animasyonu
            if (jet.shootAnimation > 0) {
                ctx.translate(0, jet.shootAnimation);
            }
            
            ctx.drawImage(jet.img, -jet.width / 2, -jet.height / 2, jet.width, jet.height);
            ctx.restore();
            
            // Motor partikÃ¼llerini Ã§iz
            for (const p of jet.engineParticles) {
                ctx.fillStyle = p.color;
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                ctx.fill();
                
                // Alev efekti
                ctx.fillStyle = p.color.replace('%)', `%, 0.5)`);
                ctx.beginPath();
                ctx.arc(p.x, p.y + p.size, p.size * 1.5, 0, Math.PI * 2);
                ctx.fill();
            }
            
            // AteÅŸ butonuna basÄ±lÄ±ysa ateÅŸ et
            if ((keys[' '] || isFiring) && timestamp - jet.lastShot > jet.shootDelay) {
                shootBullet();
                jet.lastShot = timestamp;
                jet.shootAnimation = 10;
            }
        }
        
        function updateCloneJet(timestamp) {
            // Klon jeti Ã§iz
            ctx.save();
            ctx.translate(cloneJet.x + jet.width / 2, cloneJet.y + jet.height / 2);
            ctx.globalAlpha = 0.7; // YarÄ± saydam
            ctx.drawImage(jet.img, -jet.width / 2, -jet.height / 2, jet.width, jet.height);
            ctx.restore();
            
            // Klon jet ateÅŸ etme
            if (timestamp - cloneJet.lastShot > jet.shootDelay) {
                bullets.push({
                    x: cloneJet.x + jet.width / 2 - 2.5,
                    y: cloneJet.y,
                    width: 5,
                    height: 15,
                    speed: 10,
                    color: '#3498db'
                });
                cloneJet.lastShot = timestamp;
            }
        }
        
        function shootBullet() {
            // Normal mermi (lazer efekti)
            bullets.push({
                x: jet.x + jet.width / 2 - 2.5,
                y: jet.y,
                width: 5,
                height: 15,
                speed: 12,
                color: '#00ffff',
                trail: []
            });
            
            // ÃœÃ§lÃ¼ ateÅŸ aktifse ek mermiler
            if (powerupActive === 'double') {
                bullets.push({
                    x: jet.x + jet.width / 2 - 20,
                    y: jet.y + 10,
                    width: 5,
                    height: 15,
                    speed: 12,
                    color: '#9b59b6',
                    trail: []
                });
                bullets.push({
                    x: jet.x + jet.width / 2 + 15,
                    y: jet.y + 10,
                    width: 5,
                    height: 15,
                    speed: 12,
                    color: '#9b59b6',
                    trail: []
                });
            }
            
            jet.lastShot = Date.now();
        }
        
        function spawnEnemyFire() {
            const size = 30 + Math.random() * 40;
            const type = Math.floor(Math.random() * enemyFireImgs.length);
            enemyFires.push({
                x: Math.random() * (canvas.width - size),
                y: -size,
                width: size,
                height: size,
                speed: enemyFireSpeed + Math.random() * 2,
                type: type,
                img: enemyFireImgs[type],
                rotation: Math.random() * Math.PI * 2,
                rotationSpeed: (Math.random() - 0.5) * 0.05,
                health: 1 + Math.floor(size / 20), // BÃ¼yÃ¼k toplar daha dayanÄ±klÄ±
                pulse: 0
            });
        }
        
        function spawnPowerup() {
            const types = ['health', 'clone', 'speed', 'double'];
            const weights = [0.4, 0.3, 0.2, 0.1]; // Can daha sÄ±k Ã§Ä±ksÄ±n
            let randomValue = Math.random();
            let selectedType = 'health';
            
            for (let i = 0; i < types.length; i++) {
                if (randomValue < weights[i]) {
                    selectedType = types[i];
                    break;
                }
                randomValue -= weights[i];
            }
            
            powerups.push({
                x: Math.random() * (canvas.width - 30),
                y: -30,
                width: 30,
                height: 50, // Ä°ksir ÅŸiÅŸeleri daha uzun
                speed: 2,
                type: selectedType,
                img: powerupImgs[selectedType],
                rotation: 0,
                rotationSpeed: (Math.random() - 0.5) * 0.02
            });
        }
        
        function updateEnemyFires() {
            for (let i = enemyFires.length - 1; i >= 0; i--) {
                const fire = enemyFires[i];
                fire.y += fire.speed;
                fire.rotation += fire.rotationSpeed;
                fire.pulse = Math.sin(Date.now() / 200) * 0.2 + 1;
                
                // AteÅŸ topunu Ã§iz
                ctx.save();
                ctx.translate(fire.x + fire.width / 2, fire.y + fire.height / 2);
                ctx.rotate(fire.rotation);
                ctx.scale(fire.pulse, fire.pulse);
                ctx.drawImage(fire.img, -fire.width / 2, -fire.height / 2, fire.width, fire.height);
                ctx.restore();
                
                // Ekran dÄ±ÅŸÄ±na Ã§Ä±kan ateÅŸ toplarÄ±nÄ± kaldÄ±r
                if (fire.y > canvas.height) {
                    enemyFires.splice(i, 1);
                }
            }
        }
        
        function updatePowerups() {
            for (let i = powerups.length - 1; i >= 0; i--) {
                const powerup = powerups[i];
                powerup.y += powerup.speed;
                powerup.rotation += powerup.rotationSpeed;
                
                // Ä°ksiri Ã§iz
                ctx.save();
                ctx.translate(powerup.x + powerup.width / 2, powerup.y + powerup.height / 2);
                ctx.rotate(powerup.rotation);
                ctx.drawImage(powerup.img, -powerup.width / 2, -powerup.height / 2, powerup.width, powerup.height);
                ctx.restore();
                
                // Parlama efekti
                const pulseSize = Math.sin(Date.now() / 300) * 5 + 10;
                ctx.fillStyle = powerup.type === 'health' ? 'rgba(46, 204, 113, 0.2)' : 
                                powerup.type === 'clone' ? 'rgba(52, 152, 219, 0.2)' : 
                                powerup.type === 'speed' ? 'rgba(231, 76, 60, 0.2)' : 
                                'rgba(155, 89, 182, 0.2)';
                ctx.beginPath();
                ctx.arc(
                    powerup.x + powerup.width / 2,
                    powerup.y + powerup.height / 2,
                    powerup.width / 2 + pulseSize,
                    0,
                    Math.PI * 2
                );
                ctx.fill();
                
                // Ekran dÄ±ÅŸÄ±na Ã§Ä±kan iksirleri kaldÄ±r
                if (powerup.y > canvas.height) {
                    powerups.splice(i, 1);
                }
            }
        }
        
        function updateBullets() {
            for (let i = bullets.length - 1; i >= 0; i--) {
                const bullet = bullets[i];
                bullet.y -= bullet.speed;
                
                // Mermi kuyruÄŸuna pozisyon ekle (en fazla 5)
                bullet.trail.unshift({x: bullet.x + bullet.width/2, y: bullet.y + bullet.height});
                if (bullet.trail.length > 5) bullet.trail.pop();
                
                // Mermiyi Ã§iz (lazer efekti)
                const gradient = ctx.createLinearGradient(bullet.x, bullet.y, bullet.x, bullet.y + bullet.height);
                gradient.addColorStop(0, bullet.color);
                gradient.addColorStop(1, 'rgba(0,255,255,0)');
                
                ctx.fillStyle = gradient;
                ctx.fillRect(bullet.x, bullet.y, bullet.width, bullet.height);
                
                // Mermi kuyruk efekti
                for (let j = 0; j < bullet.trail.length; j++) {
                    const alpha = 1 - (j / bullet.trail.length);
                    const size = bullet.width * (1 - j / bullet.trail.length);
                    
                    ctx.fillStyle = bullet.color.replace(')', `, ${alpha})`);
                    ctx.beginPath();
                    ctx.arc(bullet.trail[j].x, bullet.trail[j].y, size, 0, Math.PI * 2);
                    ctx.fill();
                }
                
                // Ekran dÄ±ÅŸÄ±na Ã§Ä±kan mermileri kaldÄ±r
                if (bullet.y + bullet.height < 0) {
                    bullets.splice(i, 1);
                }
            }
        }
        
        function checkCollisions() {
            // Mermi-ateÅŸ topu Ã§arpÄ±ÅŸmasÄ±
            for (let i = enemyFires.length - 1; i >= 0; i--) {
                const fire = enemyFires[i];
                
                for (let j = bullets.length - 1; j >= 0; j--) {
                    const bullet = bullets[j];
                    
                    if (
                        bullet.x < fire.x + fire.width &&
                        bullet.x + bullet.width > fire.x &&
                        bullet.y < fire.y + fire.height &&
                        bullet.y + bullet.height > fire.y
                    ) {
                        // Ã‡arpÄ±ÅŸma oldu
                        fire.health--;
                        bullets.splice(j, 1);
                        
                        if (fire.health <= 0) {
                            createExplosion(fire.x + fire.width / 2, fire.y + fire.height / 2, fire.width / 2);
                            enemyFires.splice(i, 1);
                            score += 15;
                        } else {
                            // Hasar aldÄ± ama yok olmadÄ±
                            createExplosion(
                                bullet.x + bullet.width / 2,
                                bullet.y + bullet.height / 2,
                                10,
                                false
                            );
                        }
                        
                        updateUI();
                        break;
                    }
                }
            }
            
            // Jet-ateÅŸ topu Ã§arpÄ±ÅŸmasÄ±
            for (let i = enemyFires.length - 1; i >= 0; i--) {
                const fire = enemyFires[i];
                
                if (
                    jet.x < fire.x + fire.width &&
                    jet.x + jet.width > fire.x &&
                    jet.y < fire.y + fire.height &&
                    jet.y + jet.height > fire.y
                ) {
                    // Ã‡arpÄ±ÅŸma oldu
                    createExplosion(fire.x + fire.width / 2, fire.y + fire.height / 2, fire.width / 2);
                    createExplosion(jet.x + jet.width / 2, jet.y + jet.height / 2, jet.width / 2);
                    enemyFires.splice(i, 1);
                    health -= 25;
                    updateUI();
                    
                    if (health <= 0) {
                        lives--;
                        health = 100;
                        if (lives <= 0) {
                            gameOverEffect = true;
                            gameOverTimer = 0;
                        }
                    }
                }
            }
            
            // Klon jet-ateÅŸ topu Ã§arpÄ±ÅŸmasÄ±
            if (cloneJet) {
                for (let i = enemyFires.length - 1; i >= 0; i--) {
                    const fire = enemyFires[i];
                    
                    if (
                        cloneJet.x < fire.x + fire.width &&
                        cloneJet.x + jet.width > fire.x &&
                        cloneJet.y < fire.y + fire.height &&
                        cloneJet.y + jet.height > fire.y
                    ) {
                        // Ã‡arpÄ±ÅŸma oldu
                        createExplosion(fire.x + fire.width / 2, fire.y + fire.height / 2, fire.width / 2);
                        enemyFires.splice(i, 1);
                    }
                }
            }
            
            // Jet-iksir Ã§arpÄ±ÅŸmasÄ±
            for (let i = powerups.length - 1; i >= 0; i--) {
                const powerup = powerups[i];
                
                if (
                    jet.x < powerup.x + powerup.width &&
                    jet.x + jet.width > powerup.x &&
                    jet.y < powerup.y + powerup.height &&
                    jet.y + jet.height > powerup.y
                ) {
                    // Ä°ksir toplandÄ±
                    applyPowerup(powerup.type);
                    powerups.splice(i, 1);
                    
                    // Toplama efekti
                    createExplosion(
                        powerup.x + powerup.width / 2,
                        powerup.y + powerup.height / 2,
                        30,
                        false,
                        powerup.type === 'health' ? '#2ecc71' : 
                        powerup.type === 'clone' ? '#3498db' : 
                        powerup.type === 'speed' ? '#e74c3c' : '#9b59b6'
                    );
                }
            }
        }
        
        function applyPowerup(type) {
            const now = Date.now();
            powerupActive = type;
            powerupEndTime = now + (type === 'health' ? 0 : 
                              type === 'clone' ? 10000 : 
                              type === 'speed' ? 8000 : 12000);
            
            switch(type) {
                case 'health':
                    lives = Math.min(3, lives + 1);
                    health = 100;
                    powerupActive = null;
                    break;
                    
                case 'clone':
                    cloneJet = {
                        x: jet.x - 50 + Math.random() * 100,
                        y: jet.y - 30,
                        lastShot: now
                    };
                    break;
                    
                case 'speed':
                    jet.speed = jet.baseSpeed * 1.8;
                    break;
                    
                case 'double':
                    // ÃœÃ§lÃ¼ ateÅŸ zaten shootBullet fonksiyonunda iÅŸleniyor
                    break;
            }
            
            updateUI();
            
            // GÃ¼Ã§ alÄ±ndÄ± efekti
            ctx.fillStyle = type === 'health' ? 'rgba(46, 204, 113, 0.5)' : 
                          type === 'clone' ? 'rgba(52, 152, 219, 0.5)' : 
                          type === 'speed' ? 'rgba(231, 76, 60, 0.5)' : 'rgba(155, 89, 182, 0.5)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        }
        
        function updatePowerTimer(timestamp) {
            if (!powerupActive || powerupActive === 'health') return;
            
            if (timestamp > powerupEndTime) {
                // GÃ¼Ã§ sÃ¼resi doldu
                switch(powerupActive) {
                    case 'clone':
                        cloneJet = null;
                        break;
                        
                    case 'speed':
                        jet.speed = jet.baseSpeed;
                        break;
                        
                    case 'double':
                        // ÃœÃ§lÃ¼ ateÅŸ sona erdi
                        break;
                }
                
                powerupActive = null;
                document.getElementById('powerup').textContent = 'Yok';
            } else {
                // Kalan sÃ¼reyi gÃ¶ster
                const remaining = Math.ceil((powerupEndTime - timestamp) / 1000);
                document.getElementById('powerup').textContent = 
                    powerupActive === 'clone' ? `Klon (${remaining}s)` :
                    powerupActive === 'speed' ? `HÄ±z ArtÄ±ÅŸÄ± (${remaining}s)` :
                    powerupActive === 'double' ? `ÃœÃ§lÃ¼ AteÅŸ (${remaining}s)` : '';
            }
        }
        
        function createExplosion(x, y, size, showDamage = true, color = null) {
            explosions.push({
                x: x,
                y: y,
                size: size,
                particles: [],
                createdAt: Date.now(),
                duration: 700,
                showDamage: showDamage,
                color: color
            });
            
            // Patlama parÃ§acÄ±klarÄ± oluÅŸtur
            const particleCount = size * 5;
            for (let i = 0; i < particleCount; i++) {
                const baseColor = color || `hsl(${Math.random() * 60 + 10}, 100%, 50%)`;
                
                explosions[explosions.length - 1].particles.push({
                    x: x,
                    y: y,
                    radius: Math.random() * 5 + 2,
                    color: baseColor,
                    speedX: (Math.random() - 0.5) * 10,
                    speedY: (Math.random() - 0.5) * 10,
                    life: 50 + Math.random() * 50
                });
            }
        }
        
        function updateExplosions(timestamp) {
            for (let i = explosions.length - 1; i >= 0; i--) {
                const explosion = explosions[i];
                const progress = (timestamp - explosion.createdAt) / explosion.duration;
                
                if (progress >= 1) {
                    explosions.splice(i, 1);
                    continue;
                }
                
                // Hasar yazÄ±sÄ±
                if (explosion.showDamage) {
                    ctx.fillStyle = `rgba(255, 50, 50, ${1 - progress})`;
                    ctx.font = 'bold 20px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText(`-25`, explosion.x, explosion.y - 30 - progress * 20);
                }
                
                // ParÃ§acÄ±klarÄ± gÃ¼ncelle ve Ã§iz
                for (const particle of explosion.particles) {
                    particle.x += particle.speedX;
                    particle.y += particle.speedY;
                    particle.life--;
                    
                    const alpha = Math.min(1, particle.life / 50);
                    ctx.fillStyle = particle.color.replace('%)', `%, ${alpha})`);
                    
                    ctx.beginPath();
                    ctx.arc(particle.x, particle.y, particle.radius, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // Alev efekti
                    if (Math.random() < 0.5) {
                        const flameColor = explosion.color ? 
                                          explosion.color.replace(')', `, ${alpha * 0.7})`) : 
                                          `rgba(255, ${Math.random() * 100 + 100}, 0, ${alpha * 0.7})`;
                        ctx.fillStyle = flameColor;
                        ctx.beginPath();
                        ctx.arc(
                            particle.x + (Math.random() - 0.5) * 15,
                            particle.y + (Math.random() - 0.5) * 15,
                            particle.radius * 2,
                            0,
                            Math.PI * 2
                        );
                        ctx.fill();
                    }
                }
            }
        }
        
        function updateUI() {
            document.getElementById('score').textContent = score;
            document.getElementById('lives').textContent = lives;
            healthFill.style.width = `${health}%`;
            
            // Can azaldÄ±kÃ§a rengi kÄ±rmÄ±zÄ±ya dÃ¶ner
            if (health > 60) {
                healthFill.style.background = 'linear-gradient(to right, #4CAF50, #8BC34A)';
            } else if (health > 30) {
                healthFill.style.background = 'linear-gradient(to right, #FFC107, #FF9800)';
            } else {
                healthFill.style.background = 'linear-gradient(to right, #F44336, #FF5722)';
            }
        }
        
        function gameOver() {
            gameRunning = false;
            cancelAnimationFrame(animationFrameId);
            
            startScreen.style.display = 'flex';
            const p = startScreen.querySelector('p');
            p.innerHTML = `<span class="game-over">OYUN BÄ°TTÄ°!</span><br>Skorunuz: <strong>${score}</strong>`;
            startButton.textContent = 'TEKRAR DENE';
        }
    </script>
</body>
</html>